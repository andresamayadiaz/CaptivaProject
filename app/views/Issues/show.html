#{extends 'main.html' /}
#{set title:'Issue Show' /}
<script src="@{'/public/javascripts/jquery.jqplot.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
<script src="@{'/public/javascripts/plugins/jqplot.dateAxisRenderer.js'}" type="text/javascript" charset="${_response_encoding}"></script>
<link href="@{'/public/stylesheets/jquery.jqplot.min.css'}" rel="stylesheet">

<div class="container-fluid">
    <div class="sidebar">
      <div class="well">
        <h5>Options</h5>
        <ul>
          <li><a href="#">My Projects</a></li>
          <li><a href="#">My Open Issues</a></li>
          <li><a href="#">Milestones</a></li>
          <li><a href="#">Reports</a></li>
        </ul>
      </div>
    </div>
    <div class="content">
        <div class="page-header">
            <ul class="breadcrumb">
                <li><a href="@{Projects.show(entity.Milestone?.Project?.id)}">${entity.Milestone?.Project?.Name}</a><span class="divider">/</span></li>
                <li><a href="@{Milestones.show(entity.Milestone?.id)}">${entity.Milestone?.Name}</a><span class="divider">/</span></li>
                <li>${entity.Name}</li>
            </ul>
            <h1>${entity.Name}&nbsp;&nbsp;<small>${entity?.Description}</small></h1>
        </div>
            <div class="row">
                <div class="span2">
                    <h3>Due Date</h3>
                    <p>${entity?.DueDate?.format('yyyy-MM-dd')}</p>
                </div>
                <div class="span2">
                    <h3>Created</h3>
                    <p>${entity?.created?.format('yyyy-MM-dd')}</p>
                </div>
                <div class="span2">
                    <h3>Owner</h3>
                    <p>${entity?.Owner?.fullName}</p>
                </div>
                <div class="span2">
                    <h3>Status</h3>
                    #{if entity.isOpen}
                        <span class="label success">Open</span>
                    #{/if}
                    #{else}
                         <span class="label important">Closed</span>
                    #{/else}
                </div>
                <div class="span2">
                    <h3>Est. (hrs)</h3>
                    <span class="label">${entity.estimated}</span>
                </div>
                <div class="span2">
                    <h3>Actual (hrs)</h3>
                    <span class="label">${entity.actual}</span>
                </div>
                <div class="span2">
                    <h3>Actions</h3>
                    <a href="@{Issues.edit(entity?.id)}">Edit</a>
                </div>
            </div>
        <div class="clearfix"></div>
        <!-- END MAIN ISSUE INFO -->
        
        <!-- ISSUE GRAPH -->
        <div class="row">
            <div class="span8">
                <h3>Chart</h3>
                <div id="issueChart"  style="height: 300px; width: 600px; position: relative; ">
                </div>
            </div>
        </div>
        <!-- END ISSUE GRAPH -->
        
        <div class="row">
	        <!-- Issue Comments -->
	        <div class="span8 border">
	           <h3>Comments</h3>
	           <p class="pull-right"><a href="#" data-controls-modal="new-comment-modal" data-backdrop="true">Add Comment</a></p>
		           <div id="new-comment-modal" class="modal hide fade in" >
	                <div class="modal-header">
	                    <a href="#" class="close">×</a>
	                    <h3>New Comment</h3>
	                </div>
	                #{form @Comments.save(), id:'createCommentForm'}
	                <div class="modal-body">
	                    <p>
	                        #{include 'Comments/_formModal.html' /}
	                    </p>
	                </div>
	                <div class="modal-footer">
	                    <input id="submitBtn" type="submit" class="btn primary" value="Save Comment">
	                    <script type="text/javascript">
	                    	$(document).ready(function(){
							    $("#createCommentForm").validate({
							    	submitHandler: function(form) {
									   $("#submitBtn").attr("disabled", true);
									   $(form).submit();
									 }
							    });
							  });
	                    </script>
	                </div>
	                #{/form}
	            </div>
	           <table class="bordered-table zebra-striped">
	               <thead>
                       <tr>
                           <th>User</th>
                           <th>Date</th>
                           <th>Comment</th>
                       </tr>
                   </thead>
	               <tbody>
	                   #{list items:entity?.Comments, as:'comment'}
	                       <tr>
	                           <td>
	                               <p>${comment?.createdBy.fullName}</p>
	                           </td>
	                           <td>
	                               <p>${comment?.created?.format('yyyy-MM-dd')}</p>
	                           </td>
	                           <td>
	                               <p>${comment?.comment}</p>
	                           </td>
	                       </tr>
	                   #{/list}
	               </tbody>
	           </table>
	        </div>
	        <!-- End Issue Comments -->
	        <!-- Issue Times -->
	        <div class="span8">
	           <h3>Time Registry</h3>
	           <p class="pull-right"><a href="#" data-controls-modal="new-time-modal" data-backdrop="static">Add Time</a></p>
	           <div id="new-time-modal" class="modal hide fade in" >
	                <div class="modal-header">
	                    <a href="#" class="close">×</a>
	                    <h3>Add Time</h3>
	                </div>
	                #{form @Times.save(), id:'createIssueForm'}
	                <div class="modal-body">
	                    <p>
	                        #{include 'Times/_formModal.html' /}
	                    </p>
	                </div>
	                <div class="modal-footer">
	                    <input id="submitBtn" type="submit" class="btn primary" value="Save Time">
	                    <script type="text/javascript">
	                    	$(document).ready(function(){
							    $("#createIssueForm").validate({
							    	submitHandler: function(form) {
									   $("#submitBtn").attr("disabled", true);
									   $(form).submit();
									 }
							    });
							  });
	                    </script>
	                </div>
	                #{/form}
	            </div>
	           <table class="zebra-striped condensed-table">
	               <thead>
	                   <tr>
	                       <th>User</th>
	                       <th>Date</th>
	                       <th>Comment</th>
	                       <th>Time</th>
	                   </tr>
	               </thead>
                   <tbody>
                   		#{list items:entity?.Times, as:'time'}
                   			<tr>
	                           <td>
	                               <p>${time?.createdBy.fullName}</p>
	                           </td>
	                           <td>
	                               <p>${time?.created.format('yyyy-MM-dd')}</p>
	                           </td>
	                           <td>
	                               <p>${time?.comment}</p>
	                           </td>
	                           <td>
	                               <p>${time?.time}</p>
	                           </td>
	                       </tr>
                   		#{/list}
                   </tbody>
               </table>
            </div>
	        <!-- End Issue Times -->
        </div>
        <!-- END ISSUES -->
    </div>
</div>
<script type="text/javascript">
$(document).ready(function(){

	   var ajaxData = function(url, plot, options){
		   
		   var ret = null;
		   $.ajax({
			   async: false,
			   dataType:"json",
			   url: "@{Issues.graphdata(entity.id)}",
			   success:function(data){
				   ret = data;
			   }
		   });
		   return ret;
	   }
	   
	  var jsonurl = "@{Issues.graphdata(entity.id)}";
	  //var line1=[['2008-08-12',"4"],['2008-09-12',"6.5"],['2008-10-12',"5.7"],['2008-11-12',"9"],['2008-12-12',"8.2"],['2008-12-20',"8.2"],['2008-12-25',"5"]];
	  //var line2 = [["2012-02-12","140.625"],["2012-02-13","131.25"],["2012-02-14","121.875"],["2012-02-15","112.5"],["2012-02-16","103.125"],["2012-02-17","93.75"],["2012-02-18","84.375"],["2012-02-19","75.0"],["2012-02-20","65.625"],["2012-02-21","56.25"],["2012-02-22","46.875"],["2012-02-23","37.5"],["2012-02-24","28.125"],["2012-02-25","18.75"],["2012-02-26","9.375"],["2012-02-27","0.0"]];
	  var plot1 = $.jqplot('issueChart', [], {
	    title:'Burn Down Chart',
	    dataRenderer: ajaxData,
	    axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer, min:"${entity?.created.format('yyyy-MM-dd')}", max:"${entity?.DueDate.format('yyyy-MM-dd')}"},yaxis:{renderer:$.jqplot.LinearAxisRenderer,min:"0", max:"${entity.estimated*60}"}},
	    series:[{lineWidth:2, markerOptions:{style:'square'}, showMarker:false}]
	  });
	  
    });
</script>